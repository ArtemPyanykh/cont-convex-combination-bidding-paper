%% -*- coding: cp1251 -*- %%
%% -*- ispell-dictionary: "ru" -*- %%
\documentclass[12pt,a4paper,twoside]{article}
\usepackage{geometry}
\geometry{a4paper}

\usepackage{latexsym}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}

\usepackage{graphicx}
\usepackage{float}

\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[russian]{babel}

\usepackage{bbm}
\usepackage{xargs}
\usepackage{enumerate}
\usepackage{changepage}

\usepackage{mgta}
%%\sloppy

\ppage{с. 150--152}
\setcounter{page}{1}

\markboth%
{\bf А.И. Пьяных \hfil}%
{\hfil \bf
Торги с инсайдером}

%%%
% Custom commands
%%%
\DeclareMathOperator*{\Ind}{\mathbbm{1}}
\newcommand{\Exp}{\mathbb{E}}
\newcommand{\Port}[1]{y_{#1}}
\newcommand*\di{\mathop{}\!\mathrm{d}}
\newcommandx*\F[3][1={(f,Q)}, 2=n+1]{\ensuremath{F_{#2} \left( #1, #3 \right)}}
\newcommand*\dualFPS{\ensuremath{(P, \; \sigma)}}
\newcommandx*\dualg[4][1=n, 2={\dualFPS}, 3=x, 4=\tau]{\ensuremath{g^*_{#1}(#3, #2, #4)}}
\newcommand{\Co}{\ensuremath{\beta}}
\newcommand{\Dco}{\ensuremath{{\overline{\Co}}}}
\newcommand*\Tau{\ensuremath{\mathrm{T}}}

\begin{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Header
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand{\thefootnote}{ }
\renewcommand{\footnoterule}{ \vskip 5mm \hrule width 8cm \vskip 3mm}

\footnote{\medskip \footnotesize \copyright 2015 А.И. Пьяных}

%
\copyrightheading{}
\normalsize

% обязательны коды УДК и ББК статьи
\begin{flushleft}
  УДК 519.83

  ББК 22.18
\end{flushleft}

\vskip 10mm \thispagestyle{empty}
\begin{center}
  \Large \bf \textsc{TODO: НАЗВАНИЕ СТАТЬИ}
\end{center}
\begin{center}
  \large \sc Артем И. Пьяных\\ %первый автор
  \rm
  Московский университет имени М.В. Ломоносова\\
  Факультет вычислительной математики и кибернетики\\
  119991, Москва, Ленинские горы, 2-й учебный корпус\\
  \normalsize artem.pyanykh@gmail.com\\
\end{center}

\engtitle{TODO: TITLE OF THE ARTICLE}

\engauthors{%
  \textbf{Artem Pyanykh}, Moscow State University, postgraduate
  student (artem.pyanykh@gmail.com).}

\abstr{%
  TODO: TITILE ABSTRACT.  }

\keywords{TODO: ключевые слова}

\engabstract{%
  TODO: TITILE ABSTRACT.  }

\engkeywords{TODO: keywords}

\makeinfo

\setcounter{footnote}{0}
\renewcommand{\thefootnote}{\arabic{footnote}}
\normalsize
\pagebreak

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Introduction
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Введение}

В работе [\ref{lit:demeyer02}] была рассмотрена многошаговая модель биржевых
торгов однотипными акциями, в которой торги между собой ведут два игрока. Перед
началом торгов случайный ход определяет цену акции на весь период торгов,
которая в состояниях рынка $L$ и $H$ равна $0$ и $1$ соответственно. Выбранная
цена сообщается первому игроку и не сообщается второму, при этом второй игрок
знает, что первый -- инсайдер. Также оба игрока знают вероятность $P$ высокой
цены акции.

На каждом шаге торгов игроки одновременно и независимо назначают некоторую цену
за акцию. Игроки могут делать произвольные вещественные ставки, причем игрок,
предложивший б\'{o}льшую цену, покупает у другого акцию по названной
цене. Задачей игроков является максимизация стоимости портфеля, состоящего из
некоторого числа акций и суммы денег.

Модель сводится к повторяющейся игре с неполной информацией, как описано в
[\ref{lit:aumann}], для которой Де Мейером и Салей были найдены оптимальные
стратегии игроков и значение игры. Позднее В. Доманским [\ref{lit:domansky07}]
была рассмотрена модификация модели, в которой ставки игроков могли принимать
значения только из заданного дискретного множества
$\{ i/m, \: i = \overline{0, m}, \: m \geqslant 1 \}$. В данной постановке им
было получено решение игры неограниченной продолжительности.

В обеих работах использовался одинаковый механизм проведения транзакции, при котором акция продается по наибольшей из предложенных цен.
Можно, однако, рассмотреть и следующий механизм формирования цены акции, предложенный в [\ref{lit:chatterjee83}].
Игроки одновременно предлагают цены $p_1$ и $p_2$, при $p_1 > p_2$ акция приобретается первым игроком по цене $\Co p_1 + (1-\Co) p_2$, где $\Co \in [0, 1]$ -- заданный коэффициент, характеризующий переговорную силу продавца; случай $p_1 < p_2$ симметричен; при $p_1 = p_2$ транзакции не происходит.
Более подробное обсуждение связанное с выбором подобного механизма
транзакции приведено в [\ref{lit:pyanykh14}].

Фактически, в работах [\ref{lit:demeyer02}] и [\ref{lit:domansky07}] коэффициент
$\Co$ равен $1$. Обобщение дискретной модели на случай произвольного $\Co$
было рассмотрено в [\ref{lit:pyanykh16}]. В данной работе обобщение на случай
произвольного $\Co$ проведено для модели игры с непрерывными ставками.

\section{Постановка задачи}
Обозначим множество возможных состояний рынка через $S = \{H, L\}$; $s \in S$ при этом обозначает состояние, в котором на самом деле находится рынок.

Два игрока на этом рынке на протяжении $n$ шагов ведут между собой торги за одну единицу рискового актива.
Каждый игрок делает ставку из множества $I = [0, 1]$; игрок предложивший большую ставку покупает у другого акцию по заданной цене.

Обозначим через $\Port{t} = (\Port{t}^R, \Port{t}^N)$ портфель первого игрока на $t$-ом шаге торгов, где $\Port{t}^R$ и $\Port{t}^N$ -- количество единиц рискового и безрискового активов соответственно.
Если на $t$-ом шаге игроки делают ставки $p_{1,t} \in I, \: p_{2,t} \in I$, то портфель
$\Port{t} = \Port{t-1} + t(p_{1,t}, p_{2,t})$, где при $\Co \in [0, 1], \; \Dco = 1 - \Co$
\begin{equation}\label{eq:trans-mechanism}
  t(p_1, p_2) = \Ind_{p_1 > p_2} (1, -(\Co p_1 + \Dco p_2)) +
  \Ind_{p_1 < p_2} (-1, \Dco p_1 + \Co p_2),
\end{equation}
и $\Ind_{p_1 > p_2}$ принимает значение $1$ при $p_1 > p_2$ и $0$ в противном случае.
То есть механизм проведения транзакции таков, что одна акция продается по цене равной выпуклой комбинации предложенных ставок с заданным коэффициентом $\Co$.
Стоимость портфеля при этом равна
\begin{equation*}
  V(\Port{t})=\Ind_{s = H} \, \Port{t}^R + \Port{t}^N.
\end{equation*}

Будем считать, что игроки обладают неограниченными запасами рисковых и безрисковых активов, то есть торги не могут прекратиться по причине того, что у одного из игроков закончатся деньги или акции.
Цель игроков состоит в максимизации прибыли полученной от торгов.
Таким образом, не ограничивая общности, можно положить, что в начальный момент времени оба игрока имеют нулевые портфели.
При этом прибыль первого игрока будет равна $V(\Port{n})$, а второго $-V(\Port{n})$.

Ниже мы рассмотрим теоретико-игровую постановку основной задачи (прямую игру), а также двойственной к ней в смысле Де Мейера (двойственную игру).
Как отмечено в [\ref{lit:demeyer02}], прямая игра больше подходит для анализа стратегии первого игрока, в то время как двойственную удобнее использовать при анализе стратегии второго игрока.

\subsection{Прямая игра}
Перед началом игры ходом случая определяется $s \in S$ таким образом, что $p(s = H) = P, \; p(s = L) = 1-P$.
Выбранное $s$ сообщается первому игроку (инсайдеру), второй игрок при этом не осведомлен о настоящем значении $s$ и знает только вероятности выбора случаем того или иного состояния.

Обозначим через $ h_t = (p_{1,1}, p_{2, 1}, \ldots, p_{1, t}, p_{2, t})$ историю ставок к моменту времени $t$, а через $H_t$ -- множество всевозможных $h_t$.
Стратегией первого игрока является последовательность ходов $\sigma = (\sigma_1, \ldots, \sigma_n)$, где $\sigma_t = (\sigma^L_t, \; \sigma^H_t)$.
При фиксированном $s \in S$ ход $\sigma^s_t: H_{t-1} \rightarrow \Delta(I)$ является отображением из множества историй ставок к моменту времени $t-1$ в множество $\Delta(I)$ вероятностных распределений на $I$.
То есть, на каждом шаге инсайдер в зависимости от состояния $s$ и истории $h_{t-1}$ рандомизирует выбор ставки на множестве $I$.
Обозначим множество стратегий первого игрока $\Sigma_n$.

Аналогично стратегией второго игрока назовем последовательность ходов $\tau = (\tau_1, \ldots, \tau_n)$, где $\tau_t: H_{t-1} \rightarrow \Delta(I)$.
Таким образом, не имея информации о состоянии $s$, второй игрок опирается только на историю ставок.
Обозначим множество стратегий второго игрока $\Tau_n$.


Пара стратегий $(\sigma, \tau)$ вместе с ходом случая индуцирует на $(S, H_n)$ вероятностное распределение $\Pi[P, \sigma, \tau]$.
Тогда выигрыш первого игрока равен
\[
g_n(P, \sigma, \tau) = \Exp_{\Pi[P, \sigma, \tau]} V(\Port{n}).
\]
Выигрыш второго игрока при этом равен $-g_n(P, \sigma, \tau)$.

Полученную игру обозначим через $G_n(P)$.
Ее нижнее и верхнее значения даются формулами
\begin{align*}
  V_{1,n}(P) = \sup_\sigma \inf_\tau g_n(P, \sigma, \tau), \quad
  V_{2,n}(P) = \inf_\tau \sup_\sigma g_n(P, \sigma, \tau).
\end{align*}
В том случае, когда $V_{1,n}(P) = V_{2,n}(P) = V_n(P)$, будем говорить, что игра имеет значение $V_n(P)$.

Стратегии $\sigma^*$ и $\tau^*$ называются оптимальными, если
\[
\inf_\tau g_n(P, \sigma^*, \tau) = V_{1,n}(P), \enskip
\sup_\sigma g_n(P, \sigma, \tau^*) = V_{2,n}(P).
\]

В [\ref{lit:demeyer02}] показано, что игра $G_n$ имеет рекурсивную структуру в том смысле, что задачу о нахождении выигрыша в $(n+1)$-шаговой игре можно свести в задаче о нахождении выигрыша в $n$-шаговой игре следующим образом.
Рассмотрим стратегию $\sigma$ первого игрока как пару $(\sigma_1, \tilde{\sigma})$, где $\sigma_1$ -- ход игрока на первом шаге игры, а $\tilde{\sigma}$ -- семейство стратегий в игре продолжительности $n$, зависящих от ставок $(p_{1,1}, p_{2,1})$ на первом шаге.
Аналогично стратегию $\tau$ второго игрока можно представить как пару $(\tau_1, \tilde{\tau})$.

Приведем несколько фактов, которые понадобятся нам в дальнейшем. За подробным доказательством обращаться к [\ref{lit:demeyer02}].

Пара $(\sigma_1, \tau_1)$ вместе с ходом случая индуцирует вероятностное
распределение $\Pi[P, \sigma_1, \tau_1]$ на $(S, p_{1,1}, p_{2,1})$. Обозначим через
\[
  P(p_{1,1}, p_{2,1}) = \Pi[P, \sigma_1, \tau_1](s = H \;|\; p_{1,1}, p_{2,1}).
\]
апостериорную вероятность состояния $H$ при условии, что первый игрок сделал ставку $p_{1,1}$, а второй -- $p_{2,1}$.
Так как $p_{2,1}$ не зависит от $s$, то апостериорная вероятность
\[
P(p_{1,1},p_{2,1}) = P(p_{1,1}) = \Pi[P, \sigma_1](s = H \; | \; p_{1,1})
\]
зависит только от $p_{1,1}$.

Тогда для значения выигрыша первого игрока справедливо представление
\begin{align*}
  g_{n+1}(P, \sigma, \tau) &= g_1(P, \sigma_1, \tau_1) + \\
  &+ \Exp_{\Pi[P, \sigma_1, \tau_1]}
    g_n(P(p_{1,1}), \tilde{\sigma}(p_{1,1}, p_{2,1}), \tilde{\tau}(p_{1,1}, p_{2,1})).
\end{align*}

Похожий результат имеет место и для нижнего значения игры.

\begin{lemma}
  \label{lemma:lowerBound:general}
  Для любого $P \in [0, 1]$ выполняется неравенство
  \begin{equation}
    \label{eq:fp:lowerB:nonParameterized}
    V_{1,n+1}(P) \geqslant \sup_{\sigma_1} \inf_{p_{2,1}} g_1(P, \sigma_1, p_{2,1})
    + \Exp_{\Pi[P, \sigma_1]} V_{1,n}(P(p_{1,1})).
  \end{equation}
\end{lemma}
Подчеркнем, что так как значение игры нулевой продолжительности $V_0(P) = 0$, данная формула имеет смысл для любого $n$.

\subsection{Двойственная игра}
Следуя [\ref{lit:demeyer02}], определим двойственную игру $G^*_n(x)$ следующим образом.
Перед началом игры первый игрок выбирает текущее состояние $s \in S$; второй игрок не осведомлен о выборе первого.
Если $s = H$, то первый вынужден заплатить второму пенальти размера $x$ в конце игры.
В остальном правила $G^*_n$ аналогичны правилам $G_n$.

Таким образом, стратегией первого игрока в двойственной игре является пара $\dualFPS$, где $P \in [0, 1]$, $\sigma \in \Sigma_n$.
Множество стратегий второго игрока совпадает с $\Tau_n$.

Выигрыш второго игрока, который он стремится максимизировать, определяется как
\begin{equation*}
  \dualg = x P - g_n(P, \sigma, \tau),
\end{equation*}
а верхнее и нижнее значения игры даются, соответственно, формулами
\begin{equation*}
  W_{1,n}(x) = \inf_{\dualFPS} \sup_\tau \dualg, \enskip
  W_{2,n}(x) = \sup_\tau \inf_{\dualFPS} \dualg.
\end{equation*}
В том случае, когда $W_{1,n}(x) = W_{2,n}(x) = W_n(x)$, будем говорить, что игра имеет значение $W_n(x)$.

Аналогично предыдущему пункту, можно провести рассмотрение рекурсивной структуры игры $G^*_n(x)$ и получить результат аналогичный результату леммы \ref{lemma:lowerBound:general}.
За деталями обращаться к [\ref{lit:demeyer02}].

\begin{lemma}
  \label{lemma:W:lowerBound:general}
  Для любого $x \in \mathbb{R}$ выполняется неравенство
  \begin{equation*}
    W_{2,n+1}(x) \geqslant \sup_{\tau_1} \inf_{p_{1,1}}
      W_{2,n}(x - g^H_1(p_{1,1}, \tau_1) + g^L(p_{1,1}, \tau_1)) - g^L_1(p_{1,1}, \tau_1),
  \end{equation*}
  где
  $
    g^H_1(p_{1,1},\tau_1) = g_1(1, p_{1,1}, \tau_1), \enskip
    g^L_1(p_{1,1},\tau_1) = g_1(0, p_{1,1}, \tau_1)
  $ -- выигрыши в состояниях $H$ и $L$ соответственно.
\end{lemma}
Отметим, что так как
$W^*_0(x) = \phi(x) = \min(x, 0)$,
формула имеет смысл для любого $n$.

\section{Оценки на выигрыш в прямой и двойственной играх}
Обозначим схему дальнеших рассуждений.

В секциях \ref{sec:-regular-game-estimate} и \ref{sec:-dual-game-estimate} будут построены $S$-выравнивающие стратегии первого и второго игроков в прямой и двойственной играх, соответственно.
Будет показано, что несмотря на то, что по виду данные стратегии отличается от таковых в [\ref{lit:demeyer02}], вид оценок на $V_{1,n}(P)$ и $W_{2,n}(x)$ остается неизменным.
Отсюда будет следовать справедливость двойственных соотношений между $V_{1,n}(P)$ и $W_{2,n}(x)$, существование $V_n(P)$ и $W_n(x)$, формулы для их расчета, а также оптимальность построенных стратегий.


Сделаем несколько предположений о характере функций $V_{1,n}(\cdot)$, $W_{2,n}(\cdot)$.
Обозначим через $f^*(x^*) = \inf \{ x^* \cdot x - f(x) \; | \; x \}$ сопряженную к $f$ в смысле Фенхеля функцию. Тогда потребуем, чтобы выполнялось:
\begin{enumerate}
\item
  функция $V_{1,n}(\cdot)$ гладкая на $[0, 1]$,
\item
  функция $V^*_{1,n}(\cdot)$ гладкая на $\mathbb{R}$,
\item
  функция $W_{2,n}(\cdot)$ гладкая на $\mathbb{R}$.
\end{enumerate}
Справедливость данных предположений будет обоснована в дальнейшем (см. раздел \ref{sec:-game-value}).

Также отметим, что функции $V_{1,n}(\cdot)$ и $W_{2,n}(\cdot)$ являются вогнутыми на своей области определения.
Доказательство данного факта может быть найдено в [\ref{lit:demeyer02}].

Кроме того, приведем несколько свойств субдифференциалов вогнутых функций, которые понадобятся нам в дальнейшем, а конкретно эквивалентность следующих условий (см. [\ref{lit:rockafellar}, Теорема 23.5]):
\begin{enumerate}[(a)]
\item $x^* \in \partial f(x)$,
\item $x \in \partial f^*(x^*)$,
\item $\langle z, x^* \rangle - f(z)$ достигает минимума по $z$ в точке $x$.
\end{enumerate}

\subsection{Оценка $\mathbf{V_{1,n}\left(P\right)}$}\label{sec:-regular-game-estimate}
Формула \eqref{eq:fp:lowerB:nonParameterized} дает способ получения нижней оценки $V_{1,n}(P)$, однако ее прямое использование представляет определенные трудности.
В [\ref{lit:demeyer02}] рассматривается параметризация одношаговой стратегии инсайдера функциями $f$ и $Q$, которые используются для генерации маргинального распределения $p_{1,1}$ и апостериорной вероятности $P(p_{1,1})$, соответственно, но не дается конструктивного обоснования использованию $f$ и $Q$ вместо $\sigma_1$.
Далее мы покажем, что задание стратегии первого игрока при помощи пары $(f, Q)$ в некотором смысле естественно и приведем способ перехода от параметризованного представления к оригинальному.

Обозначим через $\sigma^M_1(p_{1,1}) = P \sigma^H_1(p_{1,1}) + (1-P) \sigma^L(p_{1,1})$ маргинальное распределение $p_{1,1}$.

\begin{utver}
  Для апостериорной вероятности $P(p_{1,1})$ события $H$ справедлива формула
  \begin{equation}\label{eq:aposter:p}
    P(p_{1,1}) = (P \; \frac{\di \sigma^H_1}{\di \sigma^M_1})(p_{1,1}),
  \end{equation}
  где $\di \sigma^H_1/\di \sigma^M_1$ -- производная Радона-Никодима.
\end{utver}
\begin{proof}
  По определению $P(p_{1,1})$ для любого $B \in \mathcal{B}_I$ выполнено
  \begin{equation*}
    P(s = H, \; p_{1,1} \in B) = \int_B P(p_{1,1}) \; \sigma^M_1(\di p_{1,1}).
  \end{equation*}
  С другой стороны справедлива следующая формула:
  \begin{equation*}
    P(s = H, \; p_{1,1} \in B) = P \int_B \sigma^H_1(\di p_{1,1}).
  \end{equation*}
  Так как $\sigma^H_1$ абсолютно непрерывна относительно $\sigma^M_1$, то существует производная Радона-Никодима, а значит
  \begin{equation*}
    P(s = H, \; p_{1,1} \in B) =
    \int_B (P \frac{\di \sigma^H_1}{\di \sigma^M_1})(p_{1,1}) \; \sigma^M_1(\di p_{1,1}).
  \end{equation*}
  Отсюда получаем \eqref{eq:aposter:p}.
\end{proof}

\begin{utver}
  Для $g_1(P, \sigma_1, p_{2,1})$ справедливо представление
  \begin{equation}\label{eq:g1:marginal:aposterior}
    \begin{aligned}
      g_1(P, \sigma_1, p_{2,1}) &=
      \int_I \Ind_{p_{1,1} > p_{2,1}} \biggl[
      P(p_{1,1}) - \Co p_{1,1} - \Dco p_{2,1}
      \biggr] \; \sigma^M_1(\di p_{1,1}) \; + \\
      &+ \int_I \Ind_{p_{1,1} < p_{2,1}} \biggl[
      \Dco p_{1,1} + \Co p_{2,1} - P(p_{1,1})
      \biggr] \; \sigma^M_1(\di p_{1,1}).
    \end{aligned}
  \end{equation}
\end{utver}
\begin{proof}
  По определению
  \begin{equation}\label{eq:g1:def}
    g_1(P, \sigma_1, p_{2,1}) = \Exp_{\Pi[P, \sigma_1]} \langle
    (\Ind_{s = H}, 1), t(p_{1,1}, p_{2,1})
    \rangle.
  \end{equation}
  Подставив \eqref{eq:trans-mechanism} в \eqref{eq:g1:def}, получим
  \begin{equation}\label{eq:g1:expanded}
    \begin{gathered}
      g_1(P, \sigma_1, p_{2,1}) = P \int_I \biggl[
      \Ind_{p_{1,1} > p_{2,1}}(1 - \Co p_{1,1} - \Dco p_{2,1}) +
      \Ind_{p_{1,1} < p_{2,1}} \times \\
      \times (\Dco p_{1,1} - \Co p_{2,1} - 1)
      \biggr] \; \sigma^H_1(\di p_{1,1})
      + (1-P) \int_I \biggl[
      \Ind_{p_{1,1} > p_{2,1}} \times \\
      (- \Co p_{1,1} - \Dco p_{2,1})
      + \Ind_{p_{1,1} < p_{2,1}}(\Dco p_{1,1} - \Co p_{2,1})
      \biggr] \; \sigma^L_1(\di p_{1,1}).
    \end{gathered}
\end{equation}
Отсюда, воспользовавшись \eqref{eq:aposter:p}, получим \eqref{eq:g1:marginal:aposterior}.
\end{proof}

Формула \eqref{eq:g1:marginal:aposterior} показывает альтернативное представление стратегии инсайдера, а именно с помощью маргинального распределения ставки и апостериорной вероятности состояния $H$.
Укажем способ перехода от $\sigma_1$ к альтернативному представлению.

Возьмем случайную величину $u$ равномерно распределенную на $[0, 1]$.
Если $f(\cdot)$ -- левая обратная функции распределения $p_{1,1}$, то $f(u)$ и $p_{1,1}$ одинаково распределены.
Oбозначим $Q(u) = P(f(u))$. Пусть также $\pi = \Pi[P, \sigma_1]$.
Так как для любого $B \in \mathcal{B}_I$ выполнено
\begin{equation*}
  \pi(p_{1,1} \in B \; | \; s = H) =
  \frac{\pi(p_{1,1} \in B, \; s = H)}{\pi(s = H)} =
  \int_0^1 \Ind_{f(u) \in B} \frac{Q(u)}{P} \di u,
\end{equation*}
то восстановить $\sigma_1$ по $(f, Q)$ можно следующим образом.
Если ходом случая было выбрано состояние $H$, то инсайдер выбирает $u \in [0, 1]$ с плотностью вероятности $Q(u)/P$ и делает ставку $p_{1,1} = f(u)$.
Аналогично в состоянии $L$ он выбирает $u$ с плотностью вероятности $(1 - Q(u))/(1 - P)$ и делает ставку $p_{1,1} = f(u)$.

Введем обозначение
\[
\F{p_{2,1}} = g_1(P, (f, Q), p_{2,1}) + \Exp V_{1,n}(Q(u)).
\]
Переходя к $f$ и $Q$ в формуле \eqref{eq:g1:marginal:aposterior} получаем следующее равенство:
\begin{equation}
  \label{eq:F:pBased}
  \begin{aligned}
    \F{p_{2,1}} =
    \int_0^1 \Ind_{f(u) > p_{2,1}} (Q(u) - \beta f(u) - \alpha p_{2,1}) \di u \enskip + \\
    + \int_0^1 \Ind_{f(u) < p_{2,1}} (\alpha f(u) + \beta p_{2,1} - Q(u)) \di u \enskip
    + \int_0^1 V_{1,n}(Q(u)) \di u.
  \end{aligned}
\end{equation}

В [\ref{lit:demeyer02}] показано, что функции $f$ и $Q$ должны удовлетворять следующим свойствам, чтобы является параметризацией стратегии первого игрока:
\vspace{-2em}
\begin{adjustwidth}{\parindent}{0em}
  \begin{subequations}
    \begin{flalign}
      \label{eq:fp:strategy:par:inc}
      \bullet \quad f \text{ не убывает на } [0, 1], &&
    \end{flalign}
    \vspace{-2.5em}
    \begin{flalign}
      \label{eq:fp:strategy:par:eqP}
      \bullet \quad \int_0^1 Q(u) \di u = P, &&
    \end{flalign}
    \vspace{-2.0em}
    \begin{flalign}
      \label{eq:fp:strategy:par:apostEq}
      \bullet \quad \forall x, y \in [0, 1]: f(x) = f(y) \implies Q(x) = Q(y). &&
    \end{flalign}
  \end{subequations}
\end{adjustwidth}

Таким образом, мы можем переформулировать лемму \ref{lemma:lowerBound:general} в терминах $f$ и $Q$.
\begin{lemma}
  Для любого $P \in [0, 1]$ выполняется неравенство
  \[
    V_{1,n+1}(P) \geqslant \sup_{(f, \; Q)} \inf_{p_{2,1}} \F{p_{2,1}},
  \]
  где $f$ и $Q$ удовлетворяют \eqref{eq:fp:strategy:par:inc} -- \eqref{eq:fp:strategy:par:apostEq}.
\end{lemma}


Будем искать $S$-выравнивающую стратегию первого игрока, при $S = [f(0), f(1)]$.
Пусть $p_{2,1} = f(\alpha), \; \alpha \in [0, 1]$ и $f(\cdot)$ строго возрастает в $\alpha$.
Тогда
\begin{equation}
  \label{eq:F:fBased}
  \begin{aligned}
    &\F{f(\alpha)} = \int_\alpha^1 \left(
      Q(u) - \Co f(u) - \Dco f(\alpha)
    \right) \di u \; + \\
    & + \int_0^\alpha \left(
      \Dco f(u) + \Co f(\alpha) - Q(u)
    \right) \di u
    + \int_0^1 V_{1,n}(Q(u)) \di u.
  \end{aligned}
\end{equation}

По предположению $\F{f(\alpha)}$ не зависит от $\alpha$, следовательно
\begin{align*}
  \frac{\partial F_{n+1}}{\partial \alpha}
  = (\alpha - \Dco) f'(\alpha) + 2 f(\alpha) - 2 Q(\alpha)
  = 0.
\end{align*}
Отсюда
\begin{equation}
  \label{eq:f}
  f(u) = (u - \Dco)^{-2} \int_{\Dco}^u 2(x-\Dco) Q(x) \di x.\footnotemark
  \footnotetext{
    При $u = \Dco$ доопределим $f(\Dco)$ по непрерывности как $Q(\Dco)$.
  }
\end{equation}%

Очевидно, если подставить \eqref{eq:f} в \eqref{eq:F:fBased}, то получившееся выражение $\Phi(Q)$ зависит только от $Q$ и не зависит от $\alpha$.
Подставив $1$ вместо $\alpha$, получим
\begin{equation}\label{eq:phi:raw}
  \begin{gathered}
    \Phi(Q) =
    \int_0^1 (\Dco f(u) - Q(u)) \di u + \Co f(1) + \int_0^1 V_{1,n}(Q(u)) \di u.
  \end{gathered}
\end{equation}

\begin{lemma}
  Для $\Phi(Q)$ справедливо следующее выражение:
  \begin{equation}\label{eq:phi(q)}
    \Phi(Q) = \int_0^1 (2u - 1) Q(u) \di u + \int_0^1 V_{1,n}(Q(u)) \di u.
  \end{equation}
\end{lemma}
\begin{proof}
  Упростим \eqref{eq:phi:raw} при $\Co \in (0, 1)$.
  Случаи $\Co = 0$ и $\Co = 1$ дают тот же результат и рассматриваются аналогично.

  Найдем чему равно выражение $\int_0^1 f(u) \di u$, разбив этот интеграл на две части.
  Для первой части:
  \begin{align*}
    &\int_0^\Dco f(u) \di u = \int_0^\Dco (u - \Dco)^{-2} \int_\Dco^u 2(s - \Dco) Q(s) \di s = \\
    &= \int_0^\Dco 2 (\Dco - s) Q(s) \int_0^s (\Dco - u)^{-2} \di u \di s =
      (2/\Dco) \int_0^\Dco u Q(u) \di u.
  \end{align*}

  Аналогично для второй части:
  \begin{gather*}
    \int_\Dco^1 f(u) \di u = (2/\Co) \int_\Dco^1 (1-u) Q(u) \di u.
  \end{gather*}

  Подставив найденные выражения в \eqref{eq:phi:raw}, получим
  \begin{align*}
    &\Phi(Q) = 2 \int_0^\Dco u Q(u) \di u + (2\Dco/\Co) \int_\Dco^1 (1-u) Q(u) \di u \; + \\
    &+ (2/\Co) \int_\Dco^1 (u - \Dco) Q(u) \di u -
      \int_0^1 Q(u) \di u + \int_0^1 V_{1,n}(Q(u)) \di u.
  \end{align*}

  Приведя подобные с учетом того, что $\Dco (1-u) + u - \Dco = \Co u$, получим \eqref{eq:phi(q)}.
\end{proof}
Отметим, что хотя $f(u)$, то есть механизм рандомизации ставки инсайдером, зависит от коэффициента $\Co$, $\Phi(Q)$ от $\Co$ не зависит и по форме совпадает с аналогичным выражением в [\ref{lit:demeyer02}].

Найдем $Q$ как решение изопериметрической вариационной задачи
\begin{align}
  \label{eq:qProblem}
  \Phi(Q) \rightarrow \max, \quad
  \int_0^1 Q(u) \di u = P.
\end{align}

Перед тем, как перейти к решению \eqref{eq:qProblem}, заметим, что если функция
$f(\cdot)$ -- вогнутая и ограниченная, ее субдифференциал $\partial f(\cdot)$ не
является однозначно определенным в худшем случае не некотором счетном множестве
точек. Таким образом, если то, как определена $f'(\cdot)$ на множестве меры нуль
не существенно, $f'(\cdot)$ можно доопределить единственным образом как
непрерывную слева или справа функцию.

Применяя метод множителей Лагранжа (см. [\ref{lit:elsgolz}]), получим решение
\eqref{eq:qProblem} в следующем виде:
\begin{align}
  \label{eq:qFormula}
  &Q(u) = V^{*\prime}_{1,n}(1-\lambda-2u), \text{ где}\\
    %
  \label{eq:lambdaCond}
  &\int_0^1 V^{*\prime}_{1,n}(1-\lambda-2u) \di u = P,
\end{align}

Так как $V_{1,n}(\cdot)$ определена на $[0, 1]$, то $V^{*\prime}_{1,n}(\cdot)$
не возрастает на $\mathbb{R}$ от $1$ до $0$. Следовательно $\lambda$, удовлетворяющая
\eqref{eq:lambdaCond}, существует. Кроме того доопределим
$V^{*\prime}_{1,n}(\cdot)$ таким образом, чтобы $Q(u)$ была непрерывной справа
при $u < \alpha$ и непрерывной слева при $u \geqslant \alpha$.

\begin{lemma}
  \label{lemma:fp:fQ:isStrategy}
  Пара функций $(f, Q)$\textnormal{,} определенная в \eqref{eq:f}\textnormal{,}
  \eqref{eq:qFormula} принимает значения в $[0, 1]$ и удовлетворяет
  \eqref{eq:fp:strategy:par:inc} -- \eqref{eq:fp:strategy:par:apostEq},
  т.е. является корректной параметризацией стратегии первого игрока.
\end{lemma}
\begin{proof}
  Так как $V^{*\prime}_{1,n}(\cdot)$ убывает от $1$ до $0$, то
  $Q(\cdot)$ принимает значения в $[0, 1]$ и, кроме того, не убывает на $[0, 1]$.

  Далее, можно заметить, что $f(u)$ является математическим ожиданием $Q(x)$,
  где $x$ -- случайная величина распределенная между $\alpha$ и $u$ с плотностью
  $2|x-\alpha|/(u-\alpha)^2$. Следовательно, $f(\cdot)$ также принимает значения
  в $[0, 1]$.

  Сделаем замену переменного $t = (x - \alpha)/(u - \alpha)$  в \eqref{eq:f}. Тогда
  \begin{equation*}
    f(u) = \int_0^1 2 t Q \left( t(u - \alpha) + \alpha \right) \di t.
  \end{equation*}
  Отсюда видно, что \eqref{eq:fp:strategy:par:inc} выполнено. Далее,
  \eqref{eq:fp:strategy:par:eqP} выполнено по построению. Чтобы показать, что
  \eqref{eq:fp:strategy:par:apostEq} выполняется, рассмотрим несколько случаев.

  Пусть $\alpha < u_1 < u_2$. Тогда, так как $Q$ не убывает, почти при всех
  $t \in [0, 1]$ выполнено
  $ Q(t(u_1 - \alpha) + \alpha) = Q(t(u_2 - \alpha) + \alpha)$. Из непрерывности
  $Q$ слева следует равенство при $t = 1$, т.е. $Q(u_1) = Q(u_2)$.

  При $\alpha = u_1 < u_2$ имеем $f(u_1) = f(\alpha) = Q(\alpha)$. Отсюда почти
  при всех $t \in [0, 1]$ выполнено $Q(t(u_2 - \alpha) + \alpha) = Q(\alpha)$.
  Снова из непрерывности $Q$ слева получаем $Q(u_1) = Q(u_2) = Q(\alpha)$.

  Доказательство при $u_1 < u_2 \leqslant \alpha$ получается аналогично с
  заменой непрерывности слева на непрерывность справа. Так же рассматривается и
  случай $u_1 < \alpha < u_2$. Таким образом \eqref{eq:fp:strategy:par:apostEq}
  выполнено.
\end{proof}

\begin{lemma}
  \label{lemma:f=Q}
  Если $f(u_1) = f(u_2)$ при $u_1 < u_2$, то $f(u) = Q(u)$ при $u \in [u_1, u_2]$.
\end{lemma}
\begin{proof}
  Действительно, если $f(u_1) = f(u_2)$, то из леммы
  \ref{lemma:fp:fQ:isStrategy} следует, что $f(\cdot)$ и $Q(\cdot)$ константны
  на $[u_1, u_2]$. Тогда из \eqref{eq:f} имеем
  \begin{align*}
    f(u_2)
    &= (u_2 - \alpha)^{-2} \int_\alpha^{u_2} 2 (x - \alpha) Q(x) \di x = \\
    &= (u_2 - \alpha)^{-2} \left(
      \int_\alpha^{u_1} 2 (x - \alpha) Q(x) \di x \, +
      \int_{u_1}^{u_2} 2 (x - \alpha) Q(x) \di x
      \right) = \\
    &= (u_2 - \alpha)^{-2} \left(
      (u_1 - \alpha)^2 f(u_1) +
      \int_{u_1}^{u_2} 2 (x - \alpha) Q(u_1) \di x
      \right) = \\
    &= (u_2 - \alpha)^{-2} \left(
      (u_1 - \alpha)^2 f(u_1) +
      \left( (u_2 - \alpha)^2 - (u_2 - \alpha)^2 \right) Q(u_1)
      \right).
  \end{align*}
  С другой стороны, для $f(u_1)$ справедливо
  \begin{equation*}
    f(u_1) = (u_2 - \alpha)^{-2} \left(
      (u_1 - \alpha)^2 f(u_1) +
      \left( (u_2 - \alpha)^2 - (u_2 - \alpha)^2 \right) f(u_1)
    \right).
  \end{equation*}
  Таким образом, $f(u_1) = Q(u_1)$, а следовательно $f(u) = Q(u)$ при
  $u \in [u_1, u_2]$.
\end{proof}

Обозначим $K(\lambda) = \int_0^1 V^*_{1,n}(1-\lambda-2u) \di u$. Тогда
$K'(\lambda) = P$. Подставив \eqref{eq:qFormula}, \eqref{eq:lambdaCond} в
\eqref{eq:phi(q)}, получим
\begin{align*}
  \Phi(Q) &= \lambda \int_0^1 Q(s) \di s + \int_0^1 \left[
            (2s - 1 - \lambda) Q(s) + V_{1,n}\left( Q(s) \right)
            \right] \di s = \\
          &= P K^{*\prime}(P) - \int_0^1 \left[
            (1 + \lambda - 2s) Q(s) + V_{1,n}\left( Q(s) \right)
            \right] \di s = \\
          &= P K^{*\prime}(P) - \int_0^1 V^*_{1,n}(1 + \lambda - 2s) \di s = \\
          &= P K^{*\prime}(P) - K(\lambda) = P K^{*\prime}(P) - K(K^{*\prime}(P)) = K^*(P).
\end{align*}



\begin{theorem}
  Для выигрыша первого игрока в игре $G_n(P)$ справедлива оценка
  $V_{1,n+1}(P) \geqslant K^*(P).$
\end{theorem}
\begin{proof}
  Из леммы \ref{lemma:lowerBound:general} следует, что нам достаточно доказать,
  что при любом $p_{2,1} \in [0, 1]$ выполнено $\F{p_{2,1}} \geqslant K^*(P)$.

  Рассмотрим несколько случаев. Пусть $p_{2,1} < f(0)$. Тогда
  \begin{align*}
    &\F{p_{2,1}} = \int_0^1 \left[
      Q(u) - \beta f(u) - \alpha p_{2,1}
      \right] \di u \; + \\
    &+ \int_0^1 V_{1,n}(Q(u)) \di u \geqslant \F{f(0)} = K^*(P).
  \end{align*}
  Аналогично можно показать, что при $p_{2,1} > f(1)$
  \begin{equation*}
    \F{p_{2,1}} \geqslant \F{f(0)} = K^*(p).
  \end{equation*}
  Пусть теперь $p_{2,1} = f(\gamma), \; \gamma \in [0, 1]$. Кроме того, введем обозначения
  \[
    \gamma^- = \inf \left\{ x \;|\; f(x) = f(\gamma) \right\}, \quad
    \gamma^+ = \sup \left\{ x \;|\; f(x) = f(\gamma) \right\}.
  \]
  Тогда
  \begin{equation}
    \label{eq:fp:lower:gamma-0-1}
    \begin{aligned}
      \F{p_{2,1}}
      &= \int_{\gamma^+}^1  (Q(u) - \beta f(u) - \alpha f(\gamma)) \di u \; + \\
      &+ \int_0^{\gamma^-} (\alpha f(u) + \beta f(\gamma) - Q(u)) \di u \; + \\
      &+ \int_0^1 V_{1,n}(Q(u)) \di u.
    \end{aligned}
  \end{equation}
  Однако, из леммы \ref{lemma:f=Q} следует, что $Q(u) = f(\gamma)$ при
  $u \in [\gamma^-, \gamma^+]$. А значит \eqref{eq:fp:lower:gamma-0-1} совпадает
  с \eqref{eq:F:fBased} и $\F{p_{2,1}} \geqslant K^*(p)$ по построению.
\end{proof}

\subsection{Оценка $\mathbf{W_{2,n}\left(x\right)}$}\label{sec:-dual-game-estimate}
Аналогично тому, как это было сделано для первого игрока, параметризуем $\tau_1$
при помощи неубывающей функции $h: [0, 1] \rightarrow [0, 1]$. Если случайная
величина $u$ равномерно распределена на $[0, 1]$, положим $h(u) =
p_{2,1}$. Подобным образом может быть получено любое распределение $\tau_1$.
\begin{lemma}
  \label{lemma:W:lowerBound:parametrized}
  $W_{2,n+1} \geqslant \sup_h \inf_{p_{1,1}} G(p_{1,1}, h)$, где
  \begin{equation}
    \label{eq:W:lowerBound:parameterized}
    \begin{aligned}
    &G(p_{1,1}, h) = W_{2,n}\left(
      x - \int_0^1(\Ind_{h(u) < p_{1,1}} - \Ind_{h(u) > p(u)}) \di u
    \right) \; - \\
    &- \int_0^1 \left[
      \Ind_{h(u) < p_{1,1}} (-\beta p_{1,1} - \alpha h(u)) +
      \Ind_{h(u) > p_{1,1}} (\alpha p_{1,1} + \beta h(u))
    \right] \di u.\hspace{-.5em}
    \end{aligned}
  \end{equation}
\end{lemma}

\section{Значение игры}\label{sec:-game-value}
TODO

\vskip 10mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Footer
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  СПИСОК ЛИТЕРАТУРЫ
\end{center}

\begin{enumerate}
\item\label{lit:demeyer02}
  De Meyer B., Saley H. \textit{On the strategic origin of Brownian motion in finance} // Int J Game Theory. 2002. V. 31. P. 285--319

\item\label{lit:aumann}
  Aumann R.J., Maschler M.B. \textit{Repeated Games with Incomplete Information}. The MIT Press, Cambridge, London

\item\label{lit:domansky07}
  Domansky V. \textit{Repeated games with asymmetric information and random price fluctuations at finance markets} // Int J Game Theory. 2007. V. 36(2). P. 241--257

\item\label{lit:chatterjee83}
  Chatterjee K., Samuelson W. \textit{Bargaining under Incomplete Information} // Operations Research. 1983. V. 31. N. 5. P. 835--851

\item\label{lit:pyanykh14}
  Пьяных А.И. Об одной модификации модели биржевых торгов с инсайдером // Математическая теория игр и её приложения. 2014. 6. № 4. C. 68--84.

\item\label{lit:pyanykh16}
  Пьяных А.И. \textit{Многошаговая модель биржевых торгов с асимметричной информацией и элементами переговоров} // TODO

\item\label{lit:elsgolz}
  Эльсгольц Л.Э. \textit{Дифференциальные уравнения и вариационное исчисление}. М.: Наука, 1965.

\item\label{lit:rockafellar}
  Рокафеллар Р. \textit{Выпуклый анализ}. М.: Мир, 1973.
\end{enumerate}

\makeenginfo

\end{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%% Character code reference %%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
%     Upper case russian letters (CP1251): АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ  %
%                                                                             %
%     Lower case russian letters (CP1251): абвгдеёжзийклмнопрстуфхцчшщъыьэюя  %
%                     Upper case letters: ABCDEFGHIJKLMNOPQRSTUVWXYZ          %
%                     Lower case letters: abcdefghijklmnopqrstuvwxyz          %
%                                   Digits: 0123456789                        %
% Square, curly, angle braces, parentheses: [] {} <> ()                       %
%                Backslash, slash, solidus: \ / |                             %
%       Period, interrogative, exclamation: . ? !                             %
%                 Comma, colon, semi-colon: , : ;                             %
%          Underscore, hyphen, equals sign: _ - =                             %
%             Quotes (left, right, double): ` ' "                             %
%     Commercial-at, hash, dollar, percent: @ # $ %                           %
%  Ampersand, asterisk, plus, caret, tilde: & * +   ^                         %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
